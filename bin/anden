#!/usr/bin/env node
'use strict';

var argv, options, colors, optimist;

colors = require('colors');
optimist = require('optimist');

argv = optimist.usage('Usage: anden [options]\n\n anden -p 9000 -a localhost')
	.alias('p', 'port')
	.default('p', 9000)
	.describe('p', 'Port number')
	.alias('h', 'host')
	.default('h', 'localhost')
	.describe('h', 'Host address to use')
	.argv;

if(argv.help) return optimist.showHelp(printLine);

//How to use positional arguments with optimist?!
//also, how to enforce positional args?!!
var rootPath = argv._[0];
argv.appPath = process.cwd();

/*
// console.log(argv)
console.log('===> rootPath', rootPath)
console.log('_dirname', __dirname)
console.log('argv._', argv._)
console.log('argv.$0', argv.$0)
console.log('process.argv', process.argv)
console.log('process.argv', process.cwd())
console.log('port', argv.port)
console.log('host', argv.host)
*/

var Anden = require('../index');
var anden = new Anden();

/*anden.on('run', function(){
	console.log('------------------')
	var util = require('util');
	console.log(util.inspect(anden.app._router.stack, { showHidden: true, depth: null }));
	var routeHelper = require('../lib/utils/routes');
	routeHelper.dump(anden.app._router);
});*/

/*
var Conductor = require('../conductor');
var config = new Conductor({filename:'/Users/goliatone/Development/NODEJS/anden/examples/app/.anden.json'});
console.log(config.load());
*/

anden.run({
	host:argv.host,
	port:argv.port,
	root:argv.appPath
});


function printLine(line) {
	if(argv.pigments) return process.stdout.write(line + '\n');
	return process.stdout.write(line.stripColors + '\n');
}